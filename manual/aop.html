<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-6947936742546167",
          enable_page_level_ads: true
     });
</script>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<script type="text/javascript" src="http://apis.google.com/js/plusone.js"></script>

	<title>Ding: Aspect Oriented Programming</title>

	<style type="text/css">
		body {
  		margin-top: 1.0em;
  		background-color: #f49648;
		  font-family: "Helvetica,Arial,FreeSans";
  		color: #000000;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
		h1 { font-size: 3.8em; color: #0b69b7; margin-bottom: 3px; }
		h1 .small { font-size: 0.4em; }
		h1 a { text-decoration: none }
		h2 { font-size: 1.5em; color: #0b69b7; }
    h3 { color: #0b69b7; }
    a { color: #0b69b7; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
		pre { background: #000; color: #fff; padding: 15px;}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
	</style>

</head>

<body>

<H1><u>Aspect Oriented Programming</u></H1>
See this section in the <a href="toc.html#aop">new version of the site.</a><br/>

<g:plusone></g:plusone>
Ding has an implementation of the interceptor pattern, which is used to bring
aop in the framework. Currently, there are 2 available kind of interceptors, both
of them will call all aspects in a chained fashion. Either of those chained aspects
can break or continue the chain by choosing to (or not to) call the proceed() method.
<ul>
  <li><u>Method</u>: Called when the method is called.</li>
  <li><u>Exception</u>: Called when the called method has thrown an exception not catched.</li>
</ul>
The aspects are declared in the xml driver like this (yaml is supported, please see: docs/examples/yaml for an example):<br/>
<hr/>
<pre>
&lt;bean id="some" class="AClass" scope="prototype"&gt;
    &lt;aspect ref="AnAspectBean" type="method"&gt;
        &lt;pointcut expression="targetMethod" method="invoke"/&gt;
    &lt;/aspect&gt;
&lt;/bean&gt;<br/>
</pre>
<hr/>
<center>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6947936742546167";
/* links1 */
google_ad_slot = "7432160740";
google_ad_width = 728;
google_ad_height = 15;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</center>
<center>
  <script type="text/javascript"><!--
google_ad_client = "ca-pub-6947936742546167";
/* 6 */
google_ad_slot = "1974587443";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></center>
<center>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6947936742546167";
/* links1 */
google_ad_slot = "7432160740";
google_ad_width = 728;
google_ad_height = 15;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</center>
<p>
The above example defines a bean named "some". When the container is requested to return an
instance of this bean, it will notice that is has an aspect attached, so the bean's class is
automatically proxied and the instance of that proxy is what is really returned.<br/><br/>
In this case, the aspect references another bean that should also be known to the container. That
bean must have a method named like in the method attribute, which is to be called.
</p>
<p>
Notice the "type" attribute in the aspect tag. The other possible value for this attribute is "exception", this will attach an
ExceptionInterceptor instead of a MethodInterceptor.
</p>
<center>
<script type="text/javascript"><!--
google_ad_client = "ca-pub-6947936742546167";
/* links1 */
google_ad_slot = "7432160740";
google_ad_width = 728;
google_ad_height = 15;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>
</center>
<center>
  <script type="text/javascript"><!--
google_ad_client = "ca-pub-6947936742546167";
/* 6 */
google_ad_slot = "1974587443";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></center>
<p>
Whenever a call is made to the method defined in the pointcut tag (in this case the method is called
targetMethod), the method on your bean will be called. The same applies to exception interceptors.
</p>

<p>
You can also use regular expressions to define a pointcut for more than one method. The syntax
for the regular expression is the same as preg_match(), please see the php manual page for
this function for details. Example:
</p>
<pre>
&lt;bean id="some" class="AClass" scope="prototype"&gt;
    &lt;aspect ref="AnAspectBean" type="method"&gt;
        &lt;pointcut expression="^get$" method="invoke"/&gt;
    &lt;/aspect&gt;
&lt;/bean&gt;
</pre>
<hr/>
<H3>Sharing pointcuts (aka global pointcuts)</H3>
<p>
You can define global pointcuts and use them in your aspect definitions:
</p>
<p>
<pre>
&lt;pointcut id="aPointcut" expression="^get$"/&gt;
&lt;bean id="some" class="AClass" scope="prototype"&gt;
    &lt;aspect ref="AnAspectBean" type="method"&gt;
        &lt;pointcut pointcut-ref="aPointcut" method="invoke"/&gt;
    &lt;/aspect&gt;
&lt;/bean&gt;
</pre>
</p>
<hr/>
<H3>Global aspects</H3>
<p>
You can define global aspects using regular expressions for classes and references
to global pointcuts (which can also use regular expressions):
</p>
<p>
<pre>
&lt;pointcut id="aPointcut" expression="^get$"/&gt;
&lt;aspect id="anAspect" expression="Service$" ref="AnAspectBean" type="method"&gt;
  &lt;pointcut pointcut-ref="aPointcut"/&gt;
&lt;/aspect&gt;
</pre>
</p>
<hr/>
<p>
In the above example, the expression attribute of the aspect declaration is applied
to the class names for the beans. If the name of the class is matched, then the pointcuts
expressions are tried.
</p>
<p>
So you can define pointcuts inside aspects or globally. You can also define aspects in beans
or globally. The aspects can have references to global pointcuts or the pointcut definitions
themselves.
</p>
<H3>Using annotations</H3>
<p>
You may annotate any of your classes with @Aspect, this will tell Ding to scan
the methods of this class and look for @ExceptionInterceptor and @MethodInterceptor:
</p>
<p>
<pre>
/**
 * @Aspect
 */
class AspectA
{
    /**
     * @MethodInterceptor(class-expression=C.+,expression=g.+)
     * @ExceptionInterceptor(class-expression=C.+,expression=getB)
     */
    public function invoke(MethodInvocation $invocation)
    {
        try
        {
            echo "Before: " . $invocation->getOriginalInvocation() . "\n";
            $invocation->proceed(array('b', 'c', 'd'));
            echo "After\n";
        } catch(Exception $e) {
            echo "Move along, nothing happened here.. \n";
        }
    }

    public function __construct()
    {
    }
}
</pre>
</p>
<H3>Example</H3>
<ul>
  <li><a href="https://github.com/marcelog/Ding/tree/master/docs/examples/aop">docs/examples/aop</a>: Using the xml driver.</li>
  <li><a href="https://github.com/marcelog/Ding/tree/master/docs/examples/aop-regex">docs/examples/aop-regex</a>: Using the xml driver and regular expressions.</li>
  <li><a href="https://github.com/marcelog/Ding/tree/master/docs/examples/aop-global">docs/examples/aop-global</a>: Using the xml driver, regular expressions, and global (shared) pointcuts.</li>
  <li><a href="https://github.com/marcelog/Ding/tree/master/docs/examples/aop-annotation">docs/examples/aop-annotation</a>: Using the annotations driver.</li>
  <li><a href="https://github.com/marcelog/Ding/tree/master/docs/examples/yaml">docs/examples/yaml</a>: Using the yaml driver.</li>
</ul>
<center>
  <script type="text/javascript"><!--
google_ad_client = "ca-pub-6947936742546167";
/* 6 */
google_ad_slot = "1974587443";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>
<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></center>
    <p>
        <form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
">
<input type="image" src="https://www.paypalobjects.com/WEBSCR-640-20110306-1/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypalobjects.com/WEBSCR-640-20110306-1/en_US/i/scr/pixel.gif" width="1" height="1">
</form>
If you liked Ding (and have a generous soul, of course), please contribute so I can dedicate more of my spare time to it!
    </p>
    <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-21070993-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>